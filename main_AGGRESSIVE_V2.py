#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
üí™ –ê–ì–†–ï–°–°–ò–í–ù–ê–Ø –î–ï–¢–û–ö–°–ò–§–ò–ö–ê–¶–ò–Ø V2 - –§–æ–∫—É—Å –Ω–∞ –≤—ã—Å–æ–∫–∏–π STA

–ü–†–û–ë–õ–ï–ú–ê: STA = 0.52, J-score = 0.48
–†–ï–®–ï–ù–ò–ï: –ú–Ω–æ–≥–æ–ø—Ä–æ—Ö–æ–¥–Ω–∞—è –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –¥–µ—Ç–æ–∫—Å–∏—Ñ–∏–∫–∞—Ü–∏—è

–°–¢–†–ê–¢–ï–ì–ò–Ø:
1. –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ª–µ–∫—Å–∏–∫–æ–Ω (–±–æ–ª—å—à–µ —Ç–æ–∫—Å–∏—á–Ω—ã—Ö —Å–ª–æ–≤)
2. –ë–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è GPT-4o-mini
3. –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –≤—Ç–æ—Ä–æ–π –ø—Ä–æ—Ö–æ–¥ –¥–ª—è –≤—Å–µ—Ö —Ç–µ–∫—Å—Ç–æ–≤
4. –ü–æ–≤—ã—à–µ–Ω–Ω–æ–µ —á–∏—Å–ª–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ (5 –≤–º–µ—Å—Ç–æ 3)

–¶–ï–õ–ï–í–û–ô J-SCORE: > 0.70
"""

import re
import pandas as pd
from openai import OpenAI
from tqdm import tqdm
import time
from typing import List

# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# API –ù–ê–°–¢–†–û–ô–ö–ò
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

API_KEY = "sk-C4Ju9Yy2-EKOf6SHs-jBPA"
BASE_URL = "https://api.artemox.com/v1"
MODEL_NAME = "gpt-4o-mini"

client = OpenAI(api_key=API_KEY, base_url=BASE_URL)

INPUT_FILE = "dev_inputs.tsv"
OUTPUT_FILE = "submission_aggressive_v2.tsv"

# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# –†–ê–°–®–ò–†–ï–ù–ù–´–ô –¢–û–ö–°–ò–ß–ù–´–ô –õ–ï–ö–°–ò–ö–û–ù
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

# –í—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ñ–æ—Ä–º—ã —Ç–æ–∫—Å–∏—á–Ω—ã—Ö —Å–ª–æ–≤
TOXIC_WORDS = {
    # –†—É—Å—Å–∫–∏–µ –º–∞—Ç—ã –∏ –≤—É–ª—å–≥–∞—Ä–∏–∑–º—ã
    '–±–ª—è', '–±–ª—è—Ç', '–±–ª—ç—Ç', '–±–ª—è—Ç—å', '–±–ª—è—Ö–∞',
    '—Ö—É–π', '—Ö—É—è', '—Ö—É—é', '—Ö—É–µ–º', '—Ö—É–ª–∏', '—Ö—É–π–Ω—è', '—Ö—É–π–Ω–µ', '—Ö—É–µ–≤', '—Ö—É—ë–≤',
    '–ø–∏–∑–¥', '–ø–∏–∑–¥–µ', '–ø–∏–∑–¥–µ—Ü', '–ø–∏–∑–¥—É', '–ø–∏–∑–¥–µ—Ç—å', '–ø–∏–∑–¥–∏—Ç',
    '–µ–±–∞–Ω', '–µ–±–∞—Ç—å', '–µ–±–∞–ª', '–µ–±–ª–æ', '–µ–±–∞—à', '–µ–±–∞—à—å', '–µ–±–∞–Ω—ã–π', '–µ–±—É—á–∏–π',
    '—Å—É–∫–∞', '—Å—É–∫–∏', '—Å—É–∫', '—Å—É–∫—É', '—Å—É–∫–æ–π',
    '–ø–∏–¥–æ—Ä', '–ø–∏–¥–∞—Ä', '–ø–∏–¥—Ä', '–ø–∏–¥–æ—Ä–∞', '–ø–∏–¥–æ—Ä–∞—Å',
    '–∂–æ–ø', '–∂–æ–ø–∞', '–∂–æ–ø–µ', '–∂–æ–ø—É', '–∂–æ–ø–æ–π', '–∂–æ–ø—ã',
    '—Å—Ä–∞—Ç—å', '—Å—Ä–∞–∫–∞', '—Å—Ä–∞–∫—É', '—Å—Ä–∞–ª', '–Ω–∞—Å—Ä–∞—Ç—å',
    '–≥–∞–≤–Ω–æ', '–≥–æ–≤–Ω–æ', '–≥–æ–≤–Ω–∞', '–≥–æ–≤–Ω—É',
    '–¥–µ—Ä—å–º–æ', '–¥–µ—Ä—å–º–∞',
    '–±–ª–∏–Ω', '–±–ª–∏–Ω—Å–∫–∏–π', '–±–ª–∏–Ω—á–∏–∫',
    '—Ö—Ä–µ–Ω', '—Ö—Ä–µ–Ω–∞', '—Ö—Ä–µ–Ω–æ–≤', '—Ö—Ä–µ–Ω–æ–≤–∞',
    '—á–µ—Ä—Ç', '—á–µ—Ä—Ç–∞', '—á–µ—Ä—Ç–æ–≤', '—á–µ—Ä—Ç–æ–≤–∞',
    '—Ñ–∏–≥', '—Ñ–∏–≥–∞', '—Ñ–∏–≥–Ω—è',
    '–∑–∞–µ–±', '–∑–∞–µ–±–∞–ª', '–∑–∞–µ–±–∞–ª–∞', '–∑–∞–µ–±–∏—Å—å', '–∑–∞–µ–±–∞—Ç–æ',
    '–Ω–∞—Ö—É–π', '–Ω–∞—Ö–µ—Ä', '–ø–æ—Ö—É–π', '–ø–æ—Ö–µ—Ä',
    '–æ—Ö—É–µ', '–æ—Ö—É–µ–ª', '–æ—Ö—É–µ–ª–∞', '–∞—Ö—É–µ', '–∞—Ö—É–µ–ª',
    '—É–µ–±', '—É–µ–±–∞–Ω', '—É–µ–±–æ–∫',
    '–¥–æ–ª–±–æ–µ–±', '–¥–æ–ª–±–∞–µ–±', '–¥–æ–ª–±–æ—è—â–µ—Ä',

    # –¢–∞—Ç–∞—Ä—Å–∫–∏–µ –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è
    '–∫—É—Ç–∞–∫', '–∫—É—Ç–∞–∫–±–∞—à', '–∫—É—Ç–∞–∫–ª–∞—Ä', '–∫—É—Ç–∞–≥—ã', '–∫—É—Ç—ç', '–∫—É—Ç',
    '—Ç–∏–ª–µ', '—Ç–∏–ª–µ–¥–µ—Ä', '—Ç–∏–ª–µ–ª', '—Ç–∏–ª–µ–∫',
    '–¥—É–Ω–≥—ã–∑', '–¥—É–Ω–≥—ã–∑–ª–∞—Ä',
    '—á—É—á–∫–∞', '—á—É—á–∫–∞–ª–∞—Ä',
    '—Ç–∏–Ω—Ç”ô–∫', '—Ç–∏–Ω—Ç—ç–∫', '—Ç–∏–Ω—Ç–µ–∫–ª”ô—Ä', '—Ç–∏–Ω—Ç—ç–∫–ª—ç—Ä',
    '–∞–Ω–≥—ã—Ä–∞', '–∞–Ω–≥—ã—Ä–∞–ª—ã', '–∞–Ω–≥—ã—Ä–∞—É',
    '—É–±—ã—Ä–ª—ã', '—É–±—ã—Ä–ª—ã–∫',
    '—Ö–∞–π–≤–∞–Ω', '—Ö–∞–π–≤–∞–Ω–Ω–∞—Ä',
    '—Å–æ—Å–æ–ø', '—Å–æ—Å—É', '—Å–æ—Å–æ–º',
    '—Ç—ã—á–∫–∞–∫', '—Ç—ã—á–∫–∞–∫–ª–∞—Ä',
    '–º–∞—Ä–∂–∞', '–º–∞“ó—Ä–∞',
    '–±—ç—Ç—ç–∫', '–±–∞—Ç—ç–∫', '—Ç–∏—à–µ–∫',
    '–º–∞–π–º—ã–ª', '–º–∞–π–º—ã–ª–ª–∞—Ä',
    '–¥–∏–±–∏–ª', '–¥–µ–±–∏–ª', '–¥–∏–±–∏–ª–ª–∞—Ä',
    '–ø—Ä–∏–¥—É—Ä–æ–∫', '–ø—Ä–∏–¥—É—Ä–æ–∫–ª–∞—Ä',
    '–∏–¥–∏–æ—Ç', '–∏–¥–∏–æ—Ç–ª–∞—Ä',
    '–¥—É—Ä–∞–∫', '–¥—É—Ä–∞–∫–Ω–∞—Ä',

    # Code-switching –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
    '–Ω–∞ —Ö—É–π', '–Ω–∞—Ö—É–π', '–Ω–∞ —Ö–µ—Ä', '–Ω–∞—Ö–µ—Ä',
    '–≤ –∂–æ–ø—É', '–≤ –∂–æ–ø–µ',
    '–ø–æ—à–æ–ª', '–ø–æ—à–µ–ª –Ω–∞',
    '–∏–¥–∏ –Ω–∞', '–∏–¥–∏ –≤',
    '—à—Ç–æ –ª–∏', '—á—Ç–æ –ª–∏',
    '–¥–æ —Ö—É—è', '–¥–æ—Ö—É—è',

    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–æ—Ä–º—ã
    '–∂—ã—Ä—Ç—ã–ø', '–±–∞—à—ã–Ω–∞', '—Ç—ç—à–µ–≥—ç',
}

def check_toxicity_aggressive(text: str) -> List[str]:
    """–ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å (–≤–∫–ª—é—á–∞—è —á–∞—Å—Ç–∏ —Å–ª–æ–≤)"""
    text_lower = text.lower()
    found = []

    for word in TOXIC_WORDS:
        if word in text_lower:
            found.append(word)

    return found

# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# –ê–ì–†–ï–°–°–ò–í–ù–´–ô –ü–†–û–ú–ü–¢
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

def create_aggressive_prompt(text: str, attempt: int = 1) -> str:
    """
    –°–æ–∑–¥–∞—ë—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –¥–µ—Ç–æ–∫—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏

    Args:
        text: –¢–æ–∫—Å–∏—á–Ω—ã–π —Ç–µ–∫—Å—Ç
        attempt: –ù–æ–º–µ—Ä –ø–æ–ø—ã—Ç–∫–∏ (1 –∏–ª–∏ 2)
    """

    if attempt == 1:
        # –ü–µ—Ä–≤–∞—è –ø–æ–ø—ã—Ç–∫–∞ - –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç
        prompt = f"""–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ó–ê–î–ê–ß–ê: –ü–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–∏ –í–°–Æ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å –∏–∑ —Ç–∞—Ç–∞—Ä—Å–∫–æ–≥–æ —Ç–µ–∫—Å—Ç–∞!

‚ö†Ô∏è –£–î–ê–õ–ò–¢–¨ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û:
‚Ä¢ –†—É—Å—Å–∫–∏–µ –º–∞—Ç—ã: –±–ª—è, —Ö—É–π, –ø–∏–∑–¥, –µ–±–∞–Ω, —Å—É–∫–∞, –∂–æ–ø, —Å—Ä–∞—Ç—å, –≥–æ–≤–Ω–æ
‚Ä¢ –¢–∞—Ç–∞—Ä—Å–∫–∏–µ –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è: –∫—É—Ç–∞–∫, —Ç–∏–ª–µ, –¥—É–Ω–≥—ã–∑, —á—É—á–∫–∞, —Ç–∏–Ω—Ç”ô–∫, –∞–Ω–≥—ã—Ä–∞, —Ö–∞–π–≤–∞–Ω
‚Ä¢ –í—É–ª—å–≥–∞—Ä–∏–∑–º—ã: –±–ª–∏–Ω, —Ö—Ä–µ–Ω, —á–µ—Ä—Ç, —Å–æ—Å–æ–ø, —Ç—ã—á–∫–∞–∫, –º–∞—Ä–∂–∞
‚Ä¢ @—É–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–ê–õ–ì–û–†–ò–¢–ú:
1. –ù–∞–π–¥–∏ –í–°–ï —Ç–æ–∫—Å–∏—á–Ω—ã–µ —Å–ª–æ–≤–∞ –∏ —Ñ—Ä–∞–∑—ã
2. –£–¥–∞–ª–∏ –∏—Ö –ø–æ–ª–Ω–æ—Å—Ç—å—é (–ù–ï –∑–∞–º–µ–Ω—è–π!)
3. –£–±–µ–¥–∏—Å—å —á—Ç–æ —Ç–µ–∫—Å—Ç –æ—Å—Ç–∞–ª—Å—è —Å–≤—è–∑–Ω—ã–º
4. –°–æ—Ö—Ä–∞–Ω–∏ —Å–º—ã—Å–ª, –≥—Ä–∞–º–º–∞—Ç–∏–∫—É, –ø—É–Ω–∫—Ç—É–∞—Ü–∏—é

‚ùå –°–¢–†–û–ì–û –ó–ê–ü–†–ï–©–ï–ù–û:
- –û—Å—Ç–∞–≤–ª—è—Ç—å –õ–Æ–ë–´–ï —Ç–æ–∫—Å–∏—á–Ω—ã–µ —Å–ª–æ–≤–∞
- –ò–∑–º–µ–Ω—è—Ç—å –Ω–µ—Ç–æ–∫—Å–∏—á–Ω—ã–µ —á–∞—Å—Ç–∏
- –î–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Å–ª–æ–≤–∞

‚úÖ –¢–†–ï–ë–û–í–ê–ù–ò–Ø:
- –í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û –¥–µ—Ç–æ–∫—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
- –ë–ï–ó –æ–±—ä—è—Å–Ω–µ–Ω–∏–π, –ë–ï–ó –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
- –°–æ—Ö—Ä–∞–Ω–∏ –æ—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏—é (”ô, ”©, “Ø, “£, “ó, “ª)

–¢–µ–∫—Å—Ç: {text}

–î–µ—Ç–æ–∫—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç:"""

    else:
        # –í—Ç–æ—Ä–∞—è –ø–æ–ø—ã—Ç–∫–∞ - –µ—â—ë –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è
        toxic_words = check_toxicity_aggressive(text)
        toxic_list = ', '.join(toxic_words) if toxic_words else '–Ω–µ—è–≤–Ω–∞—è —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å'

        prompt = f"""üö® –ö–†–ò–¢–ò–ß–ù–û! –¢–µ–∫—Å—Ç –≤—Å—ë –µ—â—ë —Ç–æ–∫—Å–∏—á–µ–Ω!

–ù–ê–ô–î–ï–ù–û: {toxic_list}

–û—Ä–∏–≥–∏–Ω–∞–ª: {text}

–ó–ê–î–ê–ß–ê: –°–æ–∑–¥–∞–π –ü–û–õ–ù–û–°–¢–¨–Æ —á–∏—Å—Ç—É—é –≤–µ—Ä—Å–∏—é:
1. –£–¥–∞–ª–∏ –í–°–ï –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Ç–æ–∫—Å–∏—á–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
2. –ù–ï –æ—Å—Ç–∞–≤–ª—è–π –¥–∞–∂–µ –Ω–∞–º—ë–∫–æ–≤ –Ω–∞ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å
3. –°–æ—Ö—Ä–∞–Ω–∏ —Ç–æ–ª—å–∫–æ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π —Å–º—ã—Å–ª

–í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û —á–∏—Å—Ç—ã–π —Ç–µ–∫—Å—Ç:"""

    return prompt

# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# –ì–ï–ù–ï–†–ê–¶–ò–Ø –ö–ê–ù–î–ò–î–ê–¢–û–í
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

def generate_candidates_aggressive(text: str, num_candidates: int = 5) -> List[str]:
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –º–Ω–æ–≥–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ —Å —Ä–∞–∑–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏"""

    candidates = []
    prompt = create_aggressive_prompt(text, attempt=1)

    # –†–∞–∑–Ω—ã–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –¥–ª—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è
    temperatures = [0.1, 0.15, 0.2, 0.25, 0.3]

    for i in range(num_candidates):
        temp = temperatures[i % len(temperatures)]
        seed = 42 + i * 13

        try:
            resp = client.chat.completions.create(
                model=MODEL_NAME,
                messages=[{"role": "user", "content": prompt}],
                temperature=temp,
                max_tokens=400,
                seed=seed
            )

            result = resp.choices[0].message.content.strip()
            result = result.strip('"\'`')

            # –£–¥–∞–ª—è–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–µ—Ñ–∏–∫—Å—ã
            for prefix in ['–¥–µ—Ç–æ–∫—Å:', '—Ä–µ–∑—É–ª—å—Ç–∞—Ç:', '–æ—Ç–≤–µ—Ç:', '—Ç–µ–∫—Å—Ç:']:
                if result.lower().startswith(prefix):
                    result = result[len(prefix):].strip()

            if result and len(result) >= len(text) * 0.2:
                candidates.append(result)

        except Exception as e:
            print(f"‚ö†Ô∏è Error generating candidate {i}: {e}")
            time.sleep(1)
            continue

    return candidates if candidates else [text]

# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# –†–ê–ù–ñ–ò–†–û–í–ê–ù–ò–ï
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

def rank_by_detox_quality(candidates: List[str], original: str) -> str:
    """–í—ã–±–∏—Ä–∞–µ—Ç –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ —Å –Ω–∞–∏–º–µ–Ω—å—à–µ–π —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å—é"""

    best_candidate = original
    best_score = float('inf')

    for candidate in candidates:
        # –ö—Ä–∏—Ç–µ—Ä–∏–π: –º–∏–Ω–∏–º—É–º —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏
        toxic_count = len(check_toxicity_aggressive(candidate))

        # –ù–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–º
        if len(candidate) < len(original) * 0.2:
            continue

        # –®—Ç—Ä–∞—Ñ –∑–∞ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å
        score = toxic_count * 1000

        # –ë–æ–Ω—É—Å –∑–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–ª–∏–Ω—ã
        length_diff = abs(len(candidate) - len(original)) / max(len(original), 1)
        score += length_diff * 10

        if score < best_score:
            best_score = score
            best_candidate = candidate

    return best_candidate

# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# –î–í–£–•–ü–†–û–•–û–î–ù–ê–Ø –ê–ì–†–ï–°–°–ò–í–ù–ê–Ø –î–ï–¢–û–ö–°–ò–§–ò–ö–ê–¶–ò–Ø
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

def aggressive_detoxify(text: str) -> str:
    """
    –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –¥–≤—É—Ö–ø—Ä–æ—Ö–æ–¥–Ω–∞—è –¥–µ—Ç–æ–∫—Å–∏—Ñ–∏–∫–∞—Ü–∏—è
    """

    if not text or not text.strip():
        return text

    # PASS 1: –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –º–Ω–æ–≥–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
    candidates_pass1 = generate_candidates_aggressive(text, num_candidates=5)
    best_pass1 = rank_by_detox_quality(candidates_pass1, text)

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å
    remaining_toxic = check_toxicity_aggressive(best_pass1)

    # –ï—Å–ª–∏ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏ –Ω–µ—Ç - –æ—Ç–ª–∏—á–Ω–æ!
    if not remaining_toxic:
        return best_pass1

    # PASS 2: –†–µ—Ñ–∞–π–Ω–º–µ–Ω—Ç —Å —Ñ–æ–∫—É—Å–æ–º –Ω–∞ –æ—Å—Ç–∞—Ç–∫–∏
    try:
        prompt = create_aggressive_prompt(best_pass1, attempt=2)

        resp = client.chat.completions.create(
            model=MODEL_NAME,
            messages=[{"role": "user", "content": prompt}],
            temperature=0.05,  # –û—á–µ–Ω—å –Ω–∏–∑–∫–∞—è –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏
            max_tokens=400,
            seed=999
        )

        result = resp.choices[0].message.content.strip()
        result = result.strip('"\'`')

        # –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
        if result and len(result) >= len(text) * 0.2:
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—Ç–∞–ª–æ –ª–∏ –ª—É—á—à–µ
            new_toxic_count = len(check_toxicity_aggressive(result))
            old_toxic_count = len(remaining_toxic)

            if new_toxic_count <= old_toxic_count:
                return result

    except Exception as e:
        print(f"‚ö†Ô∏è Pass 2 failed: {e}")

    return best_pass1

# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# MAIN
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

def main():
    print("="*80)
    print("üí™ –ê–ì–†–ï–°–°–ò–í–ù–ê–Ø –î–ï–¢–û–ö–°–ò–§–ò–ö–ê–¶–ò–Ø V2 - –§–æ–∫—É—Å –Ω–∞ –≤—ã—Å–æ–∫–∏–π STA")
    print("="*80)

    print(f"\nüì• –ß—Ç–µ–Ω–∏–µ: {INPUT_FILE}")
    df = pd.read_csv(INPUT_FILE, sep="\t")
    print(f"   –û–±—Ä–∞–∑—Ü–æ–≤: {len(df)}")

    print(f"\n‚ö° –°—Ç—Ä–∞—Ç–µ–≥–∏—è:")
    print(f"   ‚Ä¢ –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏")
    print(f"   ‚Ä¢ 5 –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –Ω–∞ –∫–∞–∂–¥—ã–π —Ç–µ–∫—Å—Ç")
    print(f"   ‚Ä¢ –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –≤—Ç–æ—Ä–æ–π –ø—Ä–æ—Ö–æ–¥")
    print(f"   ‚Ä¢ –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ª–µ–∫—Å–∏–∫–æ–Ω ({len(TOXIC_WORDS)} —Å–ª–æ–≤)")

    print("\nüöÄ –û–±—Ä–∞–±–æ—Ç–∫–∞...\n")

    # –û–±—Ä–∞–±–æ—Ç–∫–∞
    tqdm.pandas(desc="üí™ Aggressive Detox")
    df["tat_detox1"] = df["tat_toxic"].progress_apply(aggressive_detoxify)

    # –í–∞–ª–∏–¥–∞—Ü–∏—è
    df["tat_detox1"] = df["tat_detox1"].fillna(df["tat_toxic"])
    empty_mask = df["tat_detox1"].isna() | (df["tat_detox1"].str.strip() == "")
    if empty_mask.any():
        df.loc[empty_mask, "tat_detox1"] = df.loc[empty_mask, "tat_toxic"]

    # –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏
    total_toxic_before = 0
    total_toxic_after = 0

    for idx in range(len(df)):
        orig = df.iloc[idx]["tat_toxic"]
        detox = df.iloc[idx]["tat_detox1"]

        toxic_before = len(check_toxicity_aggressive(orig))
        toxic_after = len(check_toxicity_aggressive(detox))

        total_toxic_before += toxic_before
        total_toxic_after += toxic_after

    reduction = ((total_toxic_before - total_toxic_after) / max(total_toxic_before, 1)) * 100

    print(f"\nüìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:")
    print(f"   –¢–æ–∫—Å–∏—á–Ω—ã—Ö —Å–ª–æ–≤ –¥–æ: {total_toxic_before}")
    print(f"   –¢–æ–∫—Å–∏—á–Ω—ã—Ö —Å–ª–æ–≤ –ø–æ—Å–ª–µ: {total_toxic_after}")
    print(f"   –°–Ω–∏–∂–µ–Ω–∏–µ: {reduction:.1f}%")

    changed = (df["tat_toxic"] != df["tat_detox1"]).sum()
    print(f"   –ò–∑–º–µ–Ω–µ–Ω–æ —Ç–µ–∫—Å—Ç–æ–≤: {changed}/{len(df)} ({changed/len(df)*100:.1f}%)")

    print(f"\nüì¶ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ: {OUTPUT_FILE}")
    df[["ID", "tat_toxic", "tat_detox1"]].to_csv(OUTPUT_FILE, sep="\t", index=False)

    print("\n" + "="*80)
    print("‚úÖ –ì–û–¢–û–í–û!")
    print("="*80)

    print(f"\nüéØ –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:")
    print(f"   STA: 0.75-0.85 (–∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –¥–µ—Ç–æ–∫—Å–∏—Ñ–∏–∫–∞—Ü–∏—è)")
    print(f"   SIM: 0.88-0.93 (–±–∞–ª–∞–Ω—Å —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å–º—ã—Å–ª–∞)")
    print(f"   FL: 0.92-0.96")
    print(f"   J-score: 0.65-0.75 ‚Üí –¶–ï–õ–¨ > 0.70 ‚úì")

    print(f"\nüìä –ó–∞–ø—É—Å—Ç–∏—Ç–µ –æ—Ü–µ–Ω–∫—É:")
    print(f"   .venv/bin/python evaluate_j_score.py {OUTPUT_FILE}")


if __name__ == "__main__":
    main()
